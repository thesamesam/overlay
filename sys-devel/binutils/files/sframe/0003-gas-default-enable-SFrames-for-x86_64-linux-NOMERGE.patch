From 8acfd42e35cc2f353522a68ffadf1061179ed24c Mon Sep 17 00:00:00 2001
Message-ID: <8acfd42e35cc2f353522a68ffadf1061179ed24c.1762172960.git.sam@gentoo.org>
In-Reply-To: <cc2f20ece05b98615ea9b9cb4df0a60486f810dc.1762172960.git.sam@gentoo.org>
References: <cc2f20ece05b98615ea9b9cb4df0a60486f810dc.1762172960.git.sam@gentoo.org>
From: Sam James <sam@gentoo.org>
Date: Sat, 26 Jul 2025 00:09:57 +0100
Subject: [PATCH 3/4] gas: default-enable SFrames for x86_64-*-linux-*
 [NOMERGE]

(I don't intend for this to be merged at this point, I've just included
it for testing.)

gas/
	PR gas/33126
	* configure: Regenerate.
	* configure.ac (ac_default_sframe): Initialize to 1 for
	x86_64-*-linux-*.
---
 gas/configure    | 7 +++++++
 gas/configure.ac | 7 +++++++
 2 files changed, 14 insertions(+)

diff --git a/gas/configure b/gas/configure
index 104fdb109dd..c98b266b7b4 100755
--- a/gas/configure
+++ b/gas/configure
@@ -12538,6 +12538,13 @@ $as_echo "#define STRICTCOFF 1" >>confdefs.h
 	   && test ${ac_default_generate_x86_used_note} = unset; then
 	  ac_default_generate_x86_used_note=1
 	fi
+
+	# If unset on x86_64-*-linux-*, let's enable it.
+	if test ${this_target} = $target \
+	   && test ${ac_default_sframe} = unset; then
+	  ac_default_sframe=1
+	fi
+
 	;;
 
       i386-*-solaris2 \
diff --git a/gas/configure.ac b/gas/configure.ac
index 4c7df3d8491..657dd760b84 100644
--- a/gas/configure.ac
+++ b/gas/configure.ac
@@ -274,6 +274,13 @@ for this_target in $target $canon_targets ; do
 	   && test ${ac_default_generate_x86_used_note} = unset; then
 	  ac_default_generate_x86_used_note=1
 	fi
+
+	# If unset on x86_64-*-linux-*, let's enable it.
+	if test ${this_target} = $target \
+	   && test ${ac_default_sframe} = unset; then
+	  ac_default_sframe=1
+	fi
+
 	;;
 
       i386-*-solaris2 \
-- 
2.51.2

